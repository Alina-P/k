\nonstopmode
\documentclass{article}
\usepackage[poster,style=bubble]{k}
\title{KOOL-TYPED-DYNAMIC}
\begin{document}
\begin{kdefinition}
\maketitle
\begin{module}{\moduleName{KOOL-TYPED-DYNAMIC-SYNTAX}}

\begin{syntaxBlock}{\nonTerminal{\sort{Id}}}\syntax{\terminal{main}}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Type}}}\syntax{\terminal{int}}{}\syntaxCont{\terminal{bool}}{}\syntaxCont{\terminal{string}}{}\syntaxCont{\terminal{void}}{}\syntaxCont{{{\nonTerminal{\sort{Type}}}}\texttt{\char91\char93}}{}\syntaxCont{({{\nonTerminal{\sort{Types}}}}\ \texttt{->}\ {{\nonTerminal{\sort{Type}}}})}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Types}}}\syntax{List\{Type, \mbox{``},\mbox{''}\}}{strict}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Decl}}}\syntax{\terminal{var}{{\nonTerminal{\sort{Exps}}}}\terminal{;}}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Exp}}}\syntax{{\nonTerminal{\sort{Int}}}}{}\syntaxCont{{\nonTerminal{\sort{Bool}}}}{}\syntaxCont{{\nonTerminal{\sort{String}}}}{}\syntaxCont{{\nonTerminal{\sort{Id}}}}{}\syntaxCont{\terminal{this}}{}\syntaxCont{\terminal{super}}{}\syntaxCont{({\nonTerminal{\sort{Exp}}})}{}\syntaxCont{\terminal{++}{{\nonTerminal{\sort{Exp}}}}}{}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{instanceOf}{{\nonTerminal{\sort{Id}}}}}{strict(1)}\syntaxCont{\terminal{cast}{{\nonTerminal{\sort{Exp}}}}\terminal{to}{{\nonTerminal{\sort{Id}}}}}{strict(1)}\syntaxCont{\terminal{new}{{\nonTerminal{\sort{Id}}}}({{\nonTerminal{\sort{Exps}}}})}{strict(2)}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{.}{{\nonTerminal{\sort{Id}}}}}{}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}[{{\nonTerminal{\sort{Exps}}}}]}{strict}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}({{\nonTerminal{\sort{Exps}}}})}{strict(2)}\syntaxCont{\terminal{-}{{\nonTerminal{\sort{Exp}}}}}{strict}\syntaxCont{\terminal{sizeOf}({{\nonTerminal{\sort{Exp}}}})}{strict}\syntaxCont{\terminal{read}()}{}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{*}{{\nonTerminal{\sort{Exp}}}}}{strict}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{/}{{\nonTerminal{\sort{Exp}}}}}{strict}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{\%}{{\nonTerminal{\sort{Exp}}}}}{strict}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{+}{{\nonTerminal{\sort{Exp}}}}}{strict}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{-}{{\nonTerminal{\sort{Exp}}}}}{strict}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{<}{{\nonTerminal{\sort{Exp}}}}}{strict, non-assoc}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{<=}{{\nonTerminal{\sort{Exp}}}}}{strict, non-assoc}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{>}{{\nonTerminal{\sort{Exp}}}}}{strict, non-assoc}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{>=}{{\nonTerminal{\sort{Exp}}}}}{strict, non-assoc}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{==}{{\nonTerminal{\sort{Exp}}}}}{strict, non-assoc}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{!=}{{\nonTerminal{\sort{Exp}}}}}{strict, non-assoc}\syntaxCont{\terminal{not}{{\nonTerminal{\sort{Exp}}}}}{strict}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{and}{{\nonTerminal{\sort{Exp}}}}}{strict}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{or}{{\nonTerminal{\sort{Exp}}}}}{strict}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{=}{{\nonTerminal{\sort{Exp}}}}}{strict(2)}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{:}{{\nonTerminal{\sort{Type}}}}}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Exps}}}\syntax{List\{Exp, \mbox{``},\mbox{''}\}}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Stmt}}}\syntax{\{\}}{}\syntaxCont{\{{{\nonTerminal{\sort{Stmts}}}}\}}{}\syntaxCont{{{\nonTerminal{\sort{Exp}}}}\terminal{;}}{strict}\syntaxCont{\terminal{if}{{\nonTerminal{\sort{Exp}}}}\terminal{then}{{\nonTerminal{\sort{Stmt}}}}\terminal{else}{{\nonTerminal{\sort{Stmt}}}}}{avoid, strict(1)}\syntaxCont{\terminal{if}{{\nonTerminal{\sort{Exp}}}}\terminal{then}{{\nonTerminal{\sort{Stmt}}}}}{}\syntaxCont{\terminal{while}{{\nonTerminal{\sort{Exp}}}}\terminal{do}{{\nonTerminal{\sort{Stmt}}}}}{}\syntaxCont{\terminal{for}{{\nonTerminal{\sort{Id}}}}\terminal{=}{{\nonTerminal{\sort{Exp}}}}\terminal{to}{{\nonTerminal{\sort{Exp}}}}\terminal{do}{{\nonTerminal{\sort{Stmt}}}}}{}\syntaxCont{\terminal{return}{{\nonTerminal{\sort{Exp}}}}\terminal{;}}{strict}\syntaxCont{\terminal{return}\terminal{;}}{}\syntaxCont{\terminal{print}({{\nonTerminal{\sort{Exps}}}})\terminal{;}}{strict}\syntaxCont{\terminal{throw}{{\nonTerminal{\sort{Exp}}}}\terminal{;}}{strict}\syntaxCont{\terminal{spawn}{{\nonTerminal{\sort{Stmt}}}}}{}\syntaxCont{\terminal{acquire}{{\nonTerminal{\sort{Exp}}}}\terminal{;}}{strict}\syntaxCont{\terminal{release}{{\nonTerminal{\sort{Exp}}}}\terminal{;}}{strict}\syntaxCont{\terminal{rendezvous}{{\nonTerminal{\sort{Exp}}}}\terminal{;}}{strict}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Stmts}}}\syntax{{\nonTerminal{\sort{Decl}}}}{}\syntaxCont{{\nonTerminal{\sort{Stmt}}}}{}\syntaxCont{{{\nonTerminal{\sort{Stmts}}}}\mathrel{}{{\nonTerminal{\sort{Stmts}}}}}{}
\end{syntaxBlock}
\krule{
\reduce{\terminal{if}{\variable[Exp]{E}}\terminal{then}{\variable[Stmt]{S}}}{\terminal{if}{\variable[Exp]{E}}\terminal{then}{\variable[Stmt]{S}}\terminal{else}{\{\}}}}{}{}
\krule{
\reduce{\terminal{for}{\variable[Id]{X}}\terminal{=}{\variable[Exp]{E1}}\terminal{to}{\variable[Exp]{E2}}\terminal{do}{\variable[Stmt]{S}}}{\{{{\terminal{var}{{{\constant[KLabel]{'\_:\_}(\variable[Id]{X}\kcomma\terminal{int})}\terminal{=}{\variable[Exp]{E1}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}\mathrel{}{\terminal{while}{{\variable[Id]{X}}\terminal{<=}{\variable[Exp]{E2}}}\terminal{do}{\{{{\variable[Stmt]{S}}\mathrel{}{{{\variable[Id]{X}}\terminal{=}{{\variable[Id]{X}}\terminal{+}{\constant[\#Int]{1}}}}\terminal{;}}}\}}}}\}}}{}{}
\krule{
\reduce{\terminal{var}{{\variable[Exp]{E1}}\mathpunct{\terminalNoSpace{,}}{{\variable[Exp]{E2}}\mathpunct{\terminalNoSpace{,}}{\variable[Exps]{Es}}}}\terminal{;}}{{\terminal{var}{{\variable[Exp]{E1}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}\mathrel{}{\terminal{var}{{\variable[Exp]{E2}}\mathpunct{\terminalNoSpace{,}}{\variable[Exps]{Es}}}\terminal{;}}}}{}{}
\krule{
\reduce{\terminal{var}{{{\constant[KLabel]{'\_:\_}(\variable[Id]{X}\kcomma\variable[Type]{T})}\terminal{=}{\variable[Exp]{E}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}{{\terminal{var}{{\constant[KLabel]{'\_:\_}(\variable[Id]{X}\kcomma\variable[Type]{T})}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}\mathrel{}{{{\variable[Id]{X}}\terminal{=}{\variable[Exp]{E}}}\terminal{;}}}}{}{}

\begin{syntaxBlock}{\nonTerminal{\sort{Id}}}\syntax{\terminal{object}}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Type}}}\syntax{\terminal{class}{{\nonTerminal{\sort{Id}}}}}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Decl}}}\syntax{\terminal{method}{{\nonTerminal{\sort{Id}}}}({{\nonTerminal{\sort{Exps}}}})\terminal{:}{{\nonTerminal{\sort{Type}}}}\mathrel{}{{\nonTerminal{\sort{Stmt}}}}}{}\syntaxCont{\terminal{method}{{\nonTerminal{\sort{Id}}}}({{\nonTerminal{\sort{Exps}}}}){{\nonTerminal{\sort{Stmt}}}}}{}
\end{syntaxBlock}
\krule{
\reduce{\terminal{method}{\variable[Id]{X}}({\variable[Exps]{Es}}){\variable[Stmt]{S}}}{\terminal{method}{\variable[Id]{X}}({\variable[Exps]{Es}})\terminal{:}{\terminal{void}}\mathrel{}{\variable[Stmt]{S}}}}{}{}

\begin{syntaxBlock}{\nonTerminal{\sort{Decl}}}\syntax{\terminal{class}{{\nonTerminal{\sort{Id}}}}\{{{\nonTerminal{\sort{Stmts}}}}\}}{}\syntaxCont{\terminal{class}{{\nonTerminal{\sort{Id}}}}\terminal{extends}{{\nonTerminal{\sort{Id}}}}\{{{\nonTerminal{\sort{Stmts}}}}\}}{}
\end{syntaxBlock}
\krule{
\reduce{\terminal{class}{\variable[Id]{C}}\{{\variable[Stmts]{Ss}}\}}{\terminal{class}{\variable[Id]{C}}\terminal{extends}{\terminal{object}}\{{\variable[Stmts]{Ss}}\}}}{}{}

\begin{syntaxBlock}{\nonTerminal{\sort{Stmt}}}\syntax{\terminal{try}{{\nonTerminal{\sort{Stmt}}}}\terminal{catch}({{\nonTerminal{\sort{Exp}}}}){{\nonTerminal{\sort{Stmt}}}}}{}
\end{syntaxBlock}
\end{module}
\begin{module}{\moduleName{KOOL-TYPED-DYNAMIC}}
\kconfig{\kall[red]{T}{\kall[orange]{threads}{\kall[yellow]{thread}{\kall[green]{k}{\variable[K]{\$PGM}\kra\terminal{execute}}
\mathrel{}\kall[violet]{env}{\dotCt{Map}}
\mathrel{}\kall[black]{holds}{\dotCt{Map}}
\mathrel{}\kall[cyan]{control}{\kall[blue]{fstack}{\dotCt{List}}
\mathrel{}\kall[purple]{xstack}{\dotCt{List}}
\mathrel{}\kall[LimeGreen]{return}{\terminal{void}}
\mathrel{}\kall[Fuchsia]{crntObj}{\kall{crntClass}{\terminal{object}}
\mathrel{}\kall{envStack}{\dotCt{List}}
\mathrel{}\kall{location}{\dotCt{K}}
}
}
}
}
\mathrel{}\kall[white]{store}{\dotCt{Map}}
\mathrel{}\kall[cyan]{busy}{\dotCt{Set}}
\mathrel{}\kall[magenta]{in}{\dotCt{List}}
\mathrel{}\kall[brown]{out}{\dotCt{List}}
\mathrel{}\kall[gray]{nextLoc}{\constant[\#Int]{0}}
\mathrel{}\kall[Fuchsia]{classes}{\kall[Fuchsia]{class}{\kall[Fuchsia]{className}{\terminal{main}}
\mathrel{}\kall[Fuchsia]{extends}{\terminal{object}}
\mathrel{}\kall[Fuchsia]{declarations}{\dotCt{K}}
}
}
}
}

\begin{syntaxBlock}{\nonTerminal{\sort{Val}}}\syntax{{\nonTerminal{\sort{Int}}}}{}\syntaxCont{{\nonTerminal{\sort{Bool}}}}{}\syntaxCont{{\nonTerminal{\sort{String}}}}{}\syntaxCont{\terminal{arrayRef}({{\nonTerminal{\sort{Type}}}},{{\nonTerminal{\sort{Int}}}},{{\nonTerminal{\sort{Int}}}})}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Vals}}}\syntax{List\{Val, \mbox{``},\mbox{''}\}}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Exp}}}\syntax{{\nonTerminal{\sort{Val}}}}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{KResult}}}\syntax{{\nonTerminal{\sort{Val}}}}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\bot_{{\nonTerminal{\sort{Type}}}}}{}
\end{syntaxBlock}
\krule{
\kprefix[green]{k}{\reduce{\terminal{var}{{\constant[KLabel]{'\_:\_}(\variable[Id]{X}\kcomma\variable[Type]{T})}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}{\dotCt{K}}}
\mathrel{}\kall[violet]{env}{\reduce{\variable[Map]{Env}}{{\variable[Map]{Env}}[{\variable[Nat]{L}}\terminal{/}{\variable[Id]{X}}]}}
\mathrel{}\kmiddle[white]{store}{\reduce{\dotCt{Map}}{\variable[Nat]{L}\mapsto\bot_{\variable[Type]{T}}}}
\mathrel{}\kall[gray]{nextLoc}{\reduce{\variable[Int]{L}}{{\variable[Nat]{L}}\mathrel{+_{\scriptstyle\it Int}}{\constant[\#Int]{1}}}}
}{}{}
\krule{
\kprefix[green]{k}{\reduce{\terminal{var}{{\constant[KLabel]{'\_:\_}({\variable[Id]{X}}[{{\variable[Int]{N}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Vals}}}]\kcomma{\variable[Type]{T}}\texttt{\char91\char93})}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}{\dotCt{K}}}
\mathrel{}\kall[violet]{env}{\reduce{\variable[Map]{Env}}{{\variable[Map]{Env}}[{\variable[Int]{L}}\terminal{/}{\variable[Id]{X}}]}}
\mathrel{}\kmiddle[white]{store}{\reduce{\dotCt{Map}}{\variable[Int]{L}\mapsto\terminal{arrayRef}({{\variable[Type]{T}}\texttt{\char91\char93}},{{\variable[Int]{L}}\mathrel{+_{\scriptstyle\it Int}}{\constant[\#Int]{1}}},{\variable[Int]{N}})\mathrel{}{{\variable[Int]{L}}\mathrel{+_{\scriptstyle\it Int}}{\constant[\#Int]{1}}}\terminal{..}{{\variable[Int]{L}}\mathrel{+_{\scriptstyle\it Int}}{\variable[Int]{N}}}\mapsto\bot_{\variable[Type]{T}}}}
\mathrel{}\kall[gray]{nextLoc}{\reduce{\variable[Int]{L}}{{{\variable[Int]{L}}\mathrel{+_{\scriptstyle\it Int}}{\constant[\#Int]{1}}}\mathrel{+_{\scriptstyle\it Int}}{\variable[Int]{N}}}}
}{}{}
\kcontext{
\terminal{var}{{\constant[KLabel]{'\_:\_}({\variable[Id]{X}}[{\khole{}}]\kcomma\variable[Type]{T})}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}{}{}

\begin{syntaxBlock}{\nonTerminal{\sort{Id}}}\syntax{\terminal{\$1}}{}\syntaxCont{\terminal{\$2}}{}
\end{syntaxBlock}
\krule{
\reduce{\terminal{var}{{\constant[KLabel]{'\_:\_}({\variable[Id]{X}}[{{\variable[Int]{N1}}\mathpunct{\terminalNoSpace{,}}{{\variable[Int]{N2}}\mathpunct{\terminalNoSpace{,}}{\variable[Vals]{Vs}}}}]\kcomma{{\variable[Type]{T}}\texttt{\char91\char93}}\texttt{\char91\char93})}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}{{\terminal{var}{{{{\variable[Id]{X}}[{{\variable[Int]{N1}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}]}\terminal{:}{{{\variable[Type]{T}}\texttt{\char91\char93}}\texttt{\char91\char93}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}\mathrel{}{\{{{\terminal{var}{{{{\terminal{\$1}}\terminal{:}{{{\variable[Type]{T}}\texttt{\char91\char93}}\texttt{\char91\char93}}}\terminal{=}{\variable[Id]{X}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}\mathrel{}{\terminal{for}{\terminal{\$2}}\terminal{=}{\constant[\#Int]{0}}\terminal{to}{{\variable[Int]{N1}}\terminal{-}{\constant[\#Int]{1}}}\terminal{do}{\{{{\terminal{var}{{{{\variable[Id]{X}}[{{\variable[Int]{N2}}\mathpunct{\terminalNoSpace{,}}{\variable[Vals]{Vs}}}]}\terminal{:}{{\variable[Type]{T}}\texttt{\char91\char93}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}\mathrel{}{{{{\terminal{\$1}}[{{\terminal{\$2}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}]}\terminal{=}{\variable[Id]{X}}}\terminal{;}}}\}}}}\}}}}{}{structural}
\krule{
\kprefix[green]{k}{\reduce{\variable[Id]{X}}{\variable[Val]{V}}}
\mathrel{}\kmiddle[violet]{env}{\variable[Id]{X}\mapsto\variable[Int]{L}}
\mathrel{}\kmiddle[white]{store}{\variable[Int]{L}\mapsto\variable[Val]{V}}
}{}{transition}
\kcontext{
\terminal{++}{\reduce{\khole{}}{\terminal{lvalue}({\khole{}})}}}{}{}
\krule{
\kprefix[green]{k}{\reduce{\terminal{++}{\terminal{loc}({\variable[Int]{L}})}}{{\variable[Int]{I}}\mathrel{+_{\scriptstyle\it Int}}{\constant[\#Int]{1}}}}
\mathrel{}\kmiddle[white]{store}{\variable[Int]{L}\mapsto\reduce{\variable[Int]{I}}{{\variable[Int]{I}}\mathrel{+_{\scriptstyle\it Int}}{\constant[\#Int]{1}}}}
}{}{transition}
\krule{
\reduce{{\variable[Int]{I1}}\terminal{+}{\variable[Int]{I2}}}{{\variable[Int]{I1}}\mathrel{+_{\scriptstyle\it Int}}{\variable[Int]{I2}}}}{}{}
\krule{
\reduce{{\variable[String]{Str1}}\terminal{+}{\variable[String]{Str2}}}{{\variable[String]{Str1}}+_{\scriptstyle\it String}{\variable[String]{Str2}}}}{}{}
\krule{
\reduce{{\variable[Int]{I1}}\terminal{-}{\variable[Int]{I2}}}{{\variable[Int]{I1}}\mathrel{-_{\scriptstyle\it Int}}{\variable[Int]{I2}}}}{}{}
\krule{
\reduce{{\variable[Int]{I1}}\terminal{*}{\variable[Int]{I2}}}{{\variable[Int]{I1}}\mathrel{\ast_{\scriptstyle\it Int}}{\variable[Int]{I2}}}}{}{}
\krule{
\reduce{{\variable[Int]{I1}}\terminal{/}{\variable[Int]{I2}}}{{\variable[Int]{I1}}\mathrel{\div_{\scriptstyle\it Int}}{\variable[Int]{I2}}}}{{\variable[Int]{I2}}\terminal{=/=Int}{\constant[\#Int]{0}}}{}
\krule{
\reduce{{\variable[Int]{I1}}\terminal{\%}{\variable[Int]{I2}}}{{\variable[Int]{I1}}\mathrel{\%_{\scriptstyle\it Int}}{\variable[Int]{I2}}}}{{\variable[Int]{I2}}\terminal{=/=Int}{\constant[\#Int]{0}}}{}
\krule{
\reduce{\terminal{-}{\variable[Int]{I}}}{{\constant[\#Int]{0}}\mathrel{-_{\scriptstyle\it Int}}{\variable[Int]{I}}}}{}{}
\krule{
\reduce{{\variable[Int]{I1}}\terminal{<}{\variable[Int]{I2}}}{{\variable[Int]{I1}}\mathrel{<_{\scriptstyle\it Int}}{\variable[Int]{I2}}}}{}{}
\krule{
\reduce{{\variable[Int]{I1}}\terminal{<=}{\variable[Int]{I2}}}{{\variable[Int]{I1}}\mathrel{\leq_{\scriptstyle\it Int}}{\variable[Int]{I2}}}}{}{}
\krule{
\reduce{{\variable[Int]{I1}}\terminal{>}{\variable[Int]{I2}}}{{\variable[Int]{I1}}\mathrel{>_{\scriptstyle\it Int}}{\variable[Int]{I2}}}}{}{}
\krule{
\reduce{{\variable[Int]{I1}}\terminal{>=}{\variable[Int]{I2}}}{{\variable[Int]{I1}}\mathrel{\geq_{\scriptstyle\it Int}}{\variable[Int]{I2}}}}{}{}
\krule{
\reduce{{\variable[Val]{V1}}\terminal{==}{\variable[Val]{V2}}}{{\variable[Val]{V1}}\terminal{==K}{\variable[Val]{V2}}}}{}{}
\krule{
\reduce{{\variable[Val]{V1}}\terminal{!=}{\variable[Val]{V2}}}{{\variable[Val]{V1}}\terminal{=/=K}{\variable[Val]{V2}}}}{}{}
\krule{
\reduce{{\variable[Bool]{B1}}\terminal{and}{\variable[Bool]{B2}}}{{\variable[Bool]{B1}}\wedge_{\scriptstyle\it Bool}{\variable[Bool]{B2}}}}{}{}
\krule{
\reduce{{\variable[Bool]{B1}}\terminal{or}{\variable[Bool]{B2}}}{{\variable[Bool]{B1}}\vee_{\scriptstyle\it Bool}{\variable[Bool]{B2}}}}{}{}
\krule{
\reduce{\terminal{not}{\variable[Bool]{B}}}{\neg_{\scriptstyle\it Bool}{\variable[Bool]{B}}}}{}{}
\krule{
\reduce{{\variable[Val]{V}}[{{\variable[Int]{N1}}\mathpunct{\terminalNoSpace{,}}{{\variable[Int]{N2}}\mathpunct{\terminalNoSpace{,}}{\variable[Vals]{Vs}}}}]}{{{\variable[Val]{V}}[{{\variable[Int]{N1}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}]}[{{\variable[Int]{N2}}\mathpunct{\terminalNoSpace{,}}{\variable[Vals]{Vs}}}]}}{}{anywhere}
\krule{
\reduce{{\terminal{arrayRef}({\AnyVar[K]},{\variable[Int]{L}},{\variable[Int]{M}})}[{{\variable[Int]{N}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}]}{\terminal{lookup}({{\variable[Int]{L}}\mathrel{+_{\scriptstyle\it Int}}{\variable[Int]{N}}})}}{{{\variable[Int]{N}}\mathrel{\geq_{\scriptstyle\it Int}}{\constant[\#Int]{0}}}\wedge_{\scriptstyle\it Bool}{{\variable[Int]{N}}\mathrel{<_{\scriptstyle\it Int}}{\variable[Int]{M}}}}{anywhere}
\krule{
\reduce{\terminal{sizeOf}({\terminal{arrayRef}({\AnyVar[K]},{\AnyVar[Int]},{\variable[Int]{N}})})}{\variable[Int]{N}}}{}{}

\begin{syntaxBlock}{\nonTerminal{\sort{Val}}}\syntax{\terminal{nothing}}{}
\end{syntaxBlock}
\krule{
\reduce{\terminal{return}\terminal{;}}{\terminal{return}{\terminal{nothing}}\terminal{;}}}{}{structural}
\krule{
\kprefix[green]{k}{\reduce{\terminal{read}()}{\variable[Int]{I}}}
\mathrel{}\kprefix[magenta]{in}{\reduce{\variable[Int]{I}}{\dotCt{List}}}
}{}{transition}
\kcontext{
{\reduce{\khole{}}{\terminal{lvalue}({\khole{}})}}\terminal{=}{\AnyVar[K]}}{}{}
\krule{
\reduce{\{\}}{\dotCt{K}}}{}{structural}
\krule{
\kprefix[green]{k}{\reduce{\{{\variable[Stmts]{Ss}}\}}{\variable[Stmts]{Ss}\kra\terminal{env}({\variable[Map]{Env}})}}
\mathrel{}\kall[violet]{env}{\variable[Map]{Env}}
}{}{structural}
\krule{
\reduce{{\variable[K]{Ss1}}\mathrel{}{\variable[K]{Ss2}}}{\variable[K]{Ss1}\kra\variable[K]{Ss2}}}{}{structural}
\krule{
\reduce{{\variable[Val]{V}}\terminal{;}}{\dotCt{K}}}{}{}
\krule{
\reduce{\terminal{if}{\constant[\#Bool]{true}}\terminal{then}{\variable[Stmt]{S}}\terminal{else}{\AnyVar[K]}}{\variable[Stmt]{S}}}{}{}
\krule{
\reduce{\terminal{if}{\constant[\#Bool]{false}}\terminal{then}{\AnyVar[K]}\terminal{else}{\variable[Stmt]{S}}}{\variable[Stmt]{S}}}{}{}
\krule{
\kprefix[green]{k}{\reduce{\terminal{while}{\variable[Exp]{E}}\terminal{do}{\variable[Stmt]{S}}}{\terminal{if}{\variable[Exp]{E}}\terminal{then}{\{{{\variable[Stmt]{S}}\mathrel{}{\terminal{while}{\variable[Exp]{E}}\terminal{do}{\variable[Stmt]{S}}}}\}}\terminal{else}{\{\}}}}
}{}{structural}
\krule{
\kprefix[green]{k}{\terminal{print}({\reduce{{\variable[Val]{V}}\mathpunct{\terminalNoSpace{,}}{\variable[Vals]{Vs}}}{\variable[Vals]{Vs}}})\terminal{;}}
\mathrel{}\ksuffix[brown]{out}{\reduce{\dotCt{List}}{\variable[Val]{V}}}
}{{{\terminal{typeOf}({\variable[Val]{V}})}\terminal{==K}{\terminal{int}}}\vee_{\scriptstyle\it Bool}{{\terminal{typeOf}({\variable[Val]{V}})}\terminal{==K}{\terminal{string}}}}{transition}
\krule{
\reduce{\terminal{print}({\dotCt{Vals}})\terminal{;}}{\dotCt{K}}}{}{structural}
\krule{
\reduce{\kmiddle[yellow]{thread}{\kall[green]{k}{\dotCt{K}}
\mathrel{}\kall[black]{holds}{\variable[Map]{H}}
}
}{\dotCt{Bag}}\mathrel{}\kall[cyan]{busy}{\reduce{\variable[Set]{Busy}}{{\variable[Set]{Busy}}\terminal{-Set}{\terminal{keys}{\variable[Map]{H}}}}}
}{}{}
\krule{
\kprefix[green]{k}{\reduce{\terminal{acquire}{\variable[Val]{V}}\terminal{;}}{\dotCt{K}}}
\mathrel{}\kmiddle[black]{holds}{\reduce{\dotCt{Map}}{\variable[Val]{V}\mapsto\constant[\#Int]{0}}}
\mathrel{}\kall[cyan]{busy}{\variable[Set]{Busy}\mathrel{}\reduce{\dotCt{Set}}{\variable[Val]{V}}}
}{\neg_{\scriptstyle\it Bool}{{\variable[Val]{V}}\terminal{in}{\variable[Set]{Busy}}}}{transition}
\krule{
\kprefix[green]{k}{\reduce{\terminal{acquire}{\variable[Val]{V}}\terminal{;}}{\dotCt{K}}}
\mathrel{}\kmiddle[black]{holds}{\variable[Val]{V}\mapsto\reduce{\variable[Int]{N}}{{\variable[Int]{N}}\mathrel{+_{\scriptstyle\it Int}}{\constant[\#Int]{1}}}}
}{}{}
\krule{
\kprefix[green]{k}{\reduce{\terminal{release}{\variable[Val]{V}}\terminal{;}}{\dotCt{K}}}
\mathrel{}\kmiddle[black]{holds}{\variable[Val]{V}\mapsto\reduce{\variable[Int]{N}}{{\variable[Int]{N}}\mathrel{-_{\scriptstyle\it Int}}{\constant[\#Int]{1}}}}
}{{\variable[Int]{N}}\mathrel{>_{\scriptstyle\it Int}}{\constant[\#Int]{0}}}{}
\krule{
\kprefix[green]{k}{\reduce{\terminal{release}{\variable[Val]{V}}\terminal{;}}{\dotCt{K}}}
\mathrel{}\kmiddle[black]{holds}{\reduce{\variable[Val]{V}\mapsto\constant[\#Int]{0}}{\dotCt{Map}}}
\mathrel{}\kmiddle[cyan]{busy}{\reduce{\variable[Val]{V}}{\dotCt{Set}}}
}{}{}
\krule{
\kprefix[green]{k}{\reduce{\terminal{rendezvous}{\variable[Val]{V}}\terminal{;}}{\dotCt{K}}}
\mathrel{}\kprefix[green]{k}{\reduce{\terminal{rendezvous}{\variable[Val]{V}}\terminal{;}}{\dotCt{K}}}
}{}{transition}

\begin{syntaxBlock}{\nonTerminal{\sort{Exp}}}\syntax{\terminal{lvalue}({{\nonTerminal{\sort{K}}}})}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{Val}}}\syntax{\terminal{loc}({{\nonTerminal{\sort{Nat}}}})}{}
\end{syntaxBlock}
\krule{
\kprefix[green]{k}{\reduce{\terminal{lvalue}({\variable[Id]{X}})}{\terminal{loc}({\variable[Int]{L}})}}
\mathrel{}\kmiddle[violet]{env}{\variable[Id]{X}\mapsto\variable[Int]{L}}
}{}{structural}
\kcontext{
\terminal{lvalue}({{\AnyVar[K]}[{\khole{}}]})}{}{}
\kcontext{
\terminal{lvalue}({{\khole{}}[{\AnyVar[K]}]})}{}{}
\krule{
\reduce{\terminal{lvalue}({\terminal{lookup}({\variable[Int]{L}})})}{\terminal{loc}({\variable[Int]{L}})}}{}{structural}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\terminal{lookup}({{\nonTerminal{\sort{Nat}}}})}{}
\end{syntaxBlock}
\krule{
\kprefix[green]{k}{\reduce{\terminal{lookup}({\variable[Int]{L}})}{\variable[Val]{V}}}
\mathrel{}\kmiddle[white]{store}{\variable[Int]{L}\mapsto\variable[Val]{V}}
}{}{transition}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\terminal{env}({{\nonTerminal{\sort{Map}}}})}{}
\end{syntaxBlock}
\krule{
\kprefix[green]{k}{\reduce{\terminal{env}({\variable[Map]{Env}})}{\dotCt{K}}}
\mathrel{}\kall[violet]{env}{\reduce{\AnyVar[Map]}{\variable[Map]{Env}}}
}{}{structural}
\krule{
\reduce{\terminal{env}({\AnyVar[Map]})}{\dotCt{K}}\kra\terminal{env}({\AnyVar[Map]})}{}{structural}

\begin{syntaxBlock}{\nonTerminal{\sort{Type}}}\syntax{\terminal{typeOf}({{\nonTerminal{\sort{K}}}})}{function, klabel(typeOf)}
\end{syntaxBlock}
\krule{
\reduce{\terminal{typeOf}({\variable[Int]{I}})}{\terminal{int}}}{}{anywhere}
\krule{
\reduce{\terminal{typeOf}({\variable[Bool]{B}})}{\terminal{bool}}}{}{anywhere}
\krule{
\reduce{\terminal{typeOf}({\AnyVar[String]})}{\terminal{string}}}{}{anywhere}
\krule{
\reduce{\terminal{typeOf}({\terminal{arrayRef}({\variable[Type]{T}},{\AnyVar[Nat]},{\AnyVar[Nat]})})}{\variable[Type]{T}}}{}{anywhere}
\krule{
\reduce{\terminal{typeOf}({\bot_{\variable[Type]{T}}})}{\variable[Type]{T}}}{}{anywhere}
\krule{
\reduce{\terminal{typeOf}({\terminal{nothing}})}{\terminal{void}}}{}{anywhere}

\begin{syntaxBlock}{\nonTerminal{\sort{Types}}}\syntax{\terminal{types}({{\nonTerminal{\sort{Exps}}}})}{function, klabel(types)}
\end{syntaxBlock}
\krule{
\reduce{\terminal{types}({\dotCt{Exps}})}{{\terminal{void}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}}}{}{anywhere}
\krule{
\reduce{\terminal{types}({{\constant[KLabel]{'\_:\_}(\variable[Id]{X}\kcomma\variable[Type]{T})}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}})}{{\variable[Type]{T}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}}}{}{anywhere}
\krule{
\reduce{\terminal{types}({{\constant[KLabel]{'\_:\_}(\variable[Id]{X}\kcomma\variable[Type]{T})}\mathpunct{\terminalNoSpace{,}}{{\variable[Exp]{E}}\mathpunct{\terminalNoSpace{,}}{\variable[Exps]{Es}}}})}{{\variable[Type]{T}}\mathpunct{\terminalNoSpace{,}}{\terminal{types}({{\variable[Exp]{E}}\mathpunct{\terminalNoSpace{,}}{\variable[Exps]{Es}}})}}}{}{anywhere}

\begin{syntaxBlock}{\nonTerminal{\sort{List\{K\}}}}\syntax{{{\nonTerminal{\sort{Int}}}}\terminal{..}{{\nonTerminal{\sort{Int}}}}}{}
\end{syntaxBlock}
\krule{
\reduce{{\variable[Int]{N1}}\terminal{..}{\variable[Int]{N2}}}{\dotCt{List{K}}}}{{\variable[Int]{N1}}\mathrel{>_{\scriptstyle\it Int}}{\variable[Int]{N2}}}{anywhere}
\krule{
\reduce{{\variable[Int]{N1}}\terminal{..}{\variable[Int]{N2}}}{\variable[Int]{N1}\kcomma{{\variable[Int]{N1}}\mathrel{+_{\scriptstyle\it Int}}{\constant[\#Int]{1}}}\terminal{..}{\variable[Int]{N2}}}}{{\variable[Int]{N1}}\mathrel{\leq_{\scriptstyle\it Int}}{\variable[Int]{N2}}}{anywhere}
\krule{
\kmiddle[yellow]{thread}{\kprefix[green]{k}{\reduce{\terminal{spawn}{\variable[Stmt]{S}}}{\dotCt{K}}}
\mathrel{}\kall[violet]{env}{\variable[Map]{Env}}
\mathrel{}\kall[Fuchsia]{crntObj}{\variable[Bag]{Obj}}
}
\mathrel{}\reduce{\dotCt{Bag}}{\kmiddle[yellow]{thread}{\kall[green]{k}{\variable[Stmt]{S}}
\mathrel{}\kall[violet]{env}{\variable[Map]{Env}}
\mathrel{}\kall[Fuchsia]{crntObj}{\variable[Bag]{Obj}}
}
}}{}{}
\krule{
\kprefix[green]{k}{\reduce{{\terminal{loc}({\variable[Int]{L}})}\terminal{=}{\variable[Val]{V}}}{\terminal{subtype}({{\terminal{typeOf}({\variable[Val]{V}})}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}},{{\terminal{typeOf}({\variable[K]{K}})}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}})\kra\terminal{true?}\kra\terminal{unsafeCast}({\variable[Val]{V}},{\terminal{typeOf}({\variable[K]{K}})})}}
\mathrel{}\kmiddle[white]{store}{\variable[Int]{L}\mapsto\reduce{\variable[K]{K}}{\terminal{unsafeCast}({\variable[Val]{V}},{\terminal{typeOf}({\variable[K]{K}})})}}
}{}{transition}

\begin{syntaxBlock}{\nonTerminal{\sort{ListItem}}}\syntax{({{\nonTerminal{\sort{Exp}}}},{{\nonTerminal{\sort{Stmt}}}},{{\nonTerminal{\sort{K}}}},{{\nonTerminal{\sort{Map}}}},{{\nonTerminal{\sort{Bag}}}})}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\terminal{popx}}{}
\end{syntaxBlock}
\krule{
\kall[green]{k}{\reduce{\terminal{try}{\variable[Stmt]{S1}}\terminal{catch}({\constant[KLabel]{'\_:\_}(\variable[Id]{X}\kcomma\variable[Type]{T})}){\variable[Stmt]{S2}}}{\variable[Stmt]{S1}\kra\terminal{popx}}\kra\variable[K]{K}}
\mathrel{}\kall[cyan]{control}{\kprefix[purple]{xstack}{\reduce{\dotCt{List}}{({\constant[KLabel]{'\_:\_}(\variable[Id]{X}\kcomma\variable[Type]{T})},{\variable[Stmt]{S2}},{\variable[K]{K}},{\variable[Map]{Env}},{\variable[Bag]{C}})}}
\mathrel{}\variable[Bag]{C}}
\mathrel{}\kall[violet]{env}{\variable[Map]{Env}}
}{}{}
\krule{
\kprefix[green]{k}{\reduce{\terminal{popx}}{\dotCt{K}}}
\mathrel{}\kprefix[purple]{xstack}{\reduce{\AnyVar[ListItem]}{\dotCt{List}}}
}{}{}
\krule{
\kall[green]{k}{\reduce{\terminal{throw}{\variable[Val]{V}}\terminal{;}\kra\AnyVar[K]}{\terminal{if}{\terminal{subtype}({{\terminal{typeOf}({\variable[Val]{V}})}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}},{{\variable[Type]{T}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}})}\terminal{then}{\{{{\terminal{var}{{{\constant[KLabel]{'\_:\_}(\variable[Id]{X}\kcomma\variable[Type]{T})}\terminal{=}{\variable[Val]{V}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Exps}}}\terminal{;}}\mathrel{}{\variable[Stmt]{S2}}}\}}\terminal{else}{\terminal{throw}{\variable[Val]{V}}\terminal{;}}\kra\variable[K]{K}}}
\mathrel{}\kall[cyan]{control}{\kprefix[purple]{xstack}{\reduce{({\constant[KLabel]{'\_:\_}(\variable[Id]{X}\kcomma\variable[Type]{T})},{\variable[Stmt]{S2}},{\variable[K]{K}},{\variable[Map]{Env}},{\variable[Bag]{C}})}{\dotCt{List}}}
\mathrel{}\reduce{\AnyVar[Bag]}{\variable[Bag]{C}}}
\mathrel{}\kall[violet]{env}{\reduce{\AnyVar[Map]}{\variable[Map]{Env}}}
}{}{}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\terminal{bindto}({{\nonTerminal{\sort{Exps}}}},{{\nonTerminal{\sort{Vals}}}})}{}
\end{syntaxBlock}
\krule{
\kprefix[green]{k}{\reduce{\dotCt{K}}{{{\variable[Id]{X}}\terminal{=}{\variable[Val]{V}}}\terminal{;}}\kra\terminal{bindto}({\reduce{{\constant[KLabel]{'\_:\_}(\variable[Id]{X}\kcomma\variable[Type]{T})}\mathpunct{\terminalNoSpace{,}}{\variable[Exps]{XTs}}}{\variable[Exps]{XTs}}},{\reduce{{\variable[Val]{V}}\mathpunct{\terminalNoSpace{,}}{\variable[Vals]{Vs}}}{\variable[Vals]{Vs}}})}
\mathrel{}\kall[violet]{env}{\reduce{\variable[Map]{Env}}{{\variable[Map]{Env}}[{\variable[Int]{L}}\terminal{/}{\variable[Id]{X}}]}}
\mathrel{}\kmiddle[white]{store}{\reduce{\dotCt{Map}}{\variable[Int]{L}\mapsto\bot_{\variable[Type]{T}}}}
\mathrel{}\kall[gray]{nextLoc}{\reduce{\variable[Int]{L}}{{\variable[Int]{L}}\mathrel{+_{\scriptstyle\it Int}}{\constant[\#Int]{1}}}}
}{}{}
\krule{
\kprefix[green]{k}{\reduce{\terminal{bindto}({\dotCt{Exps}},{\dotCt{Vals}})}{\dotCt{K}}}
}{}{structural}

\begin{syntaxBlock}{\nonTerminal{\sort{Val}}}\syntax{\terminal{objectClosure}({{\nonTerminal{\sort{Bag}}}})}{}\syntaxCont{\terminal{methodClosure}({{\nonTerminal{\sort{Id}}}},{{\nonTerminal{\sort{Nat}}}},{{\nonTerminal{\sort{Exps}}}},{{\nonTerminal{\sort{Stmt}}}},{{\nonTerminal{\sort{Type}}}})}{}
\end{syntaxBlock}
\krule{
\kprefix[green]{k}{\reduce{\terminal{class}{\variable[Id]{Class1}}\terminal{extends}{\variable[Id]{Class2}}\{{\variable[Stmts]{Ss}}\}}{\dotCt{K}}}
\mathrel{}\kmiddle[Fuchsia]{classes}{\reduce{\dotCt{Bag}}{\kall[Fuchsia]{class}{\kall[Fuchsia]{className}{\variable[Id]{Class1}}
\mathrel{}\kall[Fuchsia]{extends}{\variable[Id]{Class2}}
\mathrel{}\kall[Fuchsia]{declarations}{\variable[Stmts]{Ss}}
}
}}
}{}{structural}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\terminal{execute}}{}
\end{syntaxBlock}
\krule{
\kall[green]{k}{\reduce{\terminal{execute}}{{\terminal{new}{\terminal{main}}({\dotCt{Exps}})}\terminal{;}}}
\mathrel{}\kall[violet]{env}{\dotCt{Map}}
}{}{structural}
\krule{
\kprefix[green]{k}{\reduce{\terminal{method}{\variable[Id]{F}}({\variable[Exps]{XTs}})\terminal{:}{\variable[Type]{T}}\mathrel{}{\variable[Stmt]{S}}}{\dotCt{K}}}
\mathrel{}\kall{crntClass}{\variable[Id]{Class}}
\mathrel{}\kall{location}{\variable[Int]{OL}}
\mathrel{}\kall[violet]{env}{\reduce{\variable[Map]{Env}}{{\variable[Map]{Env}}[{\variable[Int]{L}}\terminal{/}{\variable[Id]{F}}]}}
\mathrel{}\kmiddle[white]{store}{\reduce{\dotCt{Map}}{\variable[Int]{L}\mapsto\terminal{methodClosure}({\variable[Id]{Class}},{\variable[Int]{OL}},{\variable[Exps]{XTs}},{\variable[Stmt]{S}},{({\terminal{types}({\variable[Exps]{XTs}})}\ \texttt{->}\ {\variable[Type]{T}})})}}
\mathrel{}\kall[gray]{nextLoc}{\reduce{\variable[Int]{L}}{{\variable[Int]{L}}\mathrel{+_{\scriptstyle\it Int}}{\constant[\#Int]{1}}}}
}{}{}
\krule{
\kall[green]{k}{\reduce{\constant[KLabel]{'new\_\`{}(\_\`{})}(\variable[Id]{Class}\kcomma\variable[Vals]{Vs})\kra\variable[K]{K}}{\terminal{create}({\variable[Id]{Class}})\kra\terminal{storeObj}\kra{{\constant[KLabel]{'\_\`{}(\_\`{})}(\variable[Id]{Class}\kcomma\variable[Vals]{Vs})}\terminal{;}}\mathrel{}{\terminal{return}{\terminal{this}}\terminal{;}}}}
\mathrel{}\kall[violet]{env}{\reduce{\variable[Map]{Env}}{\dotCt{Map}}}
\mathrel{}\kall[cyan]{control}{\variable[Bag]{C}\mathrel{}\kall[Fuchsia]{crntObj}{\reduce{\variable[Bag]{Obj}}{\kall{crntClass}{\terminal{object}}
\mathrel{}\kall{envStack}{{\terminal{object}}\terminal{::}{\kall{env}{\dotCt{Map}}
}}
\mathrel{}\kall{location}{\variable[Int]{L}}
}}
\mathrel{}\kall[LimeGreen]{return}{\reduce{\variable[Type]{T}}{\terminal{class}{\variable[Id]{Class}}}}
\mathrel{}\kprefix[blue]{fstack}{\reduce{\dotCt{List}}{({\variable[Map]{Env}},{\variable[K]{K}},{\variable[Bag]{C}\mathrel{}\kall{return}{\variable[Type]{T}}
\mathrel{}\kall{crntObj}{\variable[Bag]{Obj}}
})}}
}
\mathrel{}\kall[gray]{nextLoc}{\reduce{\variable[Int]{L}}{{\variable[Int]{L}}\mathrel{+_{\scriptstyle\it Int}}{\constant[\#Int]{1}}}}
}{}{}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\terminal{create}({{\nonTerminal{\sort{K}}}})}{}
\end{syntaxBlock}
\krule{
\kprefix[green]{k}{\reduce{\terminal{create}({\variable[Id]{Class}})}{\terminal{create}({\variable[Id]{Class1}})\kra\terminal{setCrntClass}({\variable[Id]{Class}})\kra\variable[Stmts]{Ss}\kra\terminal{addEnvLayer}}}
\mathrel{}\kall[Fuchsia]{className}{\variable[Id]{Class}}
\mathrel{}\kall[Fuchsia]{extends}{\variable[Id]{Class1}}
\mathrel{}\kall[Fuchsia]{declarations}{\variable[Stmts]{Ss}}
}{}{structural}
\krule{
\kprefix[green]{k}{\reduce{\terminal{create}({\terminal{object}})}{\dotCt{K}}}
}{}{structural}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\terminal{setCrntClass}({{\nonTerminal{\sort{Id}}}})}{}
\end{syntaxBlock}
\krule{
\kprefix[green]{k}{\reduce{\terminal{setCrntClass}({\variable[K]{Class}})}{\dotCt{K}}}
\mathrel{}\kall{crntClass}{\reduce{\AnyVar[K]}{\variable[K]{Class}}}
}{}{structural}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\terminal{addEnvLayer}}{}
\end{syntaxBlock}
\krule{
\kprefix[green]{k}{\reduce{\terminal{addEnvLayer}}{\dotCt{K}}}
\mathrel{}\kall[violet]{env}{\reduce{\variable[Map]{Env}}{\dotCt{Map}}}
\mathrel{}\kall{crntClass}{\variable[Id]{Class}}
\mathrel{}\kprefix{envStack}{\reduce{\dotCt{List}}{{\variable[Id]{Class}}\terminal{::}{\kall{env}{\variable[Map]{Env}}
}}}
}{}{structural}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\terminal{storeObj}}{}
\end{syntaxBlock}
\krule{
\kprefix[green]{k}{\reduce{\terminal{storeObj}}{\dotCt{K}}}
\mathrel{}\kall[Fuchsia]{crntObj}{\variable[Bag]{Obj}\mathrel{}\reduce{\kall{location}{\variable[Int]{L}}
}{\dotCt{Bag}}}
\mathrel{}\kmiddle[white]{store}{\reduce{\dotCt{Map}}{\variable[Int]{L}\mapsto\terminal{objectClosure}({\variable[Bag]{Obj}})}}
}{}{}
\krule{
\kprefix[green]{k}{\reduce{\terminal{this}}{\terminal{objectClosure}({\variable[Bag]{Obj}})}}
\mathrel{}\kall[Fuchsia]{crntObj}{\variable[Bag]{Obj}}
}{}{}
\krule{
\kprefix[green]{k}{\reduce{\variable[Id]{X}}{\constant[KLabel]{'\_.\_}(\terminal{this}\kcomma\variable[Id]{X})}}
\mathrel{}\kall[violet]{env}{\variable[Map]{Env}}
}{\neg_{\scriptstyle\it Bool}{{\variable[Id]{X}}\terminal{in}{\terminal{keys}{\variable[Map]{Env}}}}}{structural}
\kcontext{
\constant[KLabel]{'\_.\_}(\khole{}\kcomma\AnyVar[List\{K\}])}{{\khole{}}\terminal{=/=K}{\terminal{super}}}{}
\krule{
\kprefix[green]{k}{\reduce{\constant[KLabel]{'\_.\_}(\terminal{objectClosure}({\kall{crntClass}{\variable[Id]{Class}}
\mathrel{}\ksuffix{envStack}{{\variable[Id]{Class}}\terminal{::}{\variable[BagItem]{EnvC}}\mathrel{}\variable[List]{EStack}}
})\kcomma\variable[Id]{X})}{\terminal{lookupMember}({\kall{envStack}{{\variable[Id]{Class}}\terminal{::}{\variable[BagItem]{EnvC}}\mathrel{}\variable[List]{EStack}}
},{\variable[Id]{X}})}}
}{}{structural}
\krule{
\kprefix[green]{k}{\reduce{\constant[KLabel]{'\_.\_}(\terminal{super}\kcomma\variable[Id]{X})}{\terminal{lookupMember}({\kall{envStack}{\variable[List]{EStack}}
},{\variable[Id]{X}})}}
\mathrel{}\kall{crntClass}{\variable[Id]{Class}}
\mathrel{}\ksuffix{envStack}{{\variable[Id]{Class}}\terminal{::}{\variable[BagItem]{EnvC}}\mathrel{}\variable[List]{EStack}}
}{}{structural}
\krule{
\kprefix[green]{k}{\constant[KLabel]{'\_\`{}(\_\`{})}(\reduce{\variable[Id]{X}}{\variable[Val]{V}}\kcomma\AnyVar[List\{K\}])}
\mathrel{}\kmiddle[violet]{env}{\variable[Id]{X}\mapsto\variable[Int]{L}}
\mathrel{}\kmiddle[white]{store}{\variable[Int]{L}\mapsto\variable[Val]{V}}
}{}{}
\krule{
\kprefix[green]{k}{\constant[KLabel]{'\_\`{}(\_\`{})}(\reduce{\variable[Id]{X}}{\constant[KLabel]{'\_.\_}(\terminal{this}\kcomma\variable[Id]{X})}\kcomma\AnyVar[List\{K\}])}
\mathrel{}\kall[violet]{env}{\variable[Map]{Env}}
}{\neg_{\scriptstyle\it Bool}{{\variable[Id]{X}}\terminal{in}{\terminal{keys}{\variable[Map]{Env}}}}}{structural}
\kcontext{
\constant[KLabel]{'\_\`{}(\_\`{})}(\constant[KLabel]{'\_.\_}(\khole{}\kcomma\AnyVar[List\{K\}])\kcomma\AnyVar[List\{K\}])}{{\khole{}}\terminal{=/=K}{\terminal{super}}}{}
\krule{
\kprefix[green]{k}{\constant[KLabel]{'\_\`{}(\_\`{})}(\reduce{\constant[KLabel]{'\_.\_}(\terminal{objectClosure}({\variable[Bag]{Obj}\mathrel{}\kall{envStack}{\variable[List]{EStack}}
})\kcomma\variable[Id]{X})}{\terminal{lookupMember}({\kall{envStack}{\variable[List]{EStack}}
},{\variable[Id]{X}})}\kcomma\AnyVar[List\{K\}])}
}{}{structural}
\krule{
\kprefix[green]{k}{\constant[KLabel]{'\_\`{}(\_\`{})}(\reduce{\constant[KLabel]{'\_.\_}(\terminal{super}\kcomma\variable[Id]{X})}{\terminal{lookupMember}({\kall{envStack}{\variable[List]{EStack}}
},{\variable[Id]{X}})}\kcomma\AnyVar[List\{K\}])}
\mathrel{}\kall{crntClass}{\variable[Id]{Class}}
\mathrel{}\ksuffix{envStack}{{\variable[Id]{Class}}\terminal{::}{\AnyVar[Bag]}\mathrel{}\variable[List]{EStack}}
}{}{structural}
\kcontext{
\constant[KLabel]{'\_\`{}(\_\`{})}(\khole{}\kcomma\AnyVar[List\{K\}])}{{{\terminal{getKLabel}{\khole{}}}\terminal{==KLabel}{\constant[KLabel]{'\_\`{}(\_\`{})}}}\vee_{\scriptstyle\it Bool}{{\terminal{getKLabel}{\khole{}}}\terminal{==KLabel}{\constant[KLabel]{'\_\`{}[\_\`{}]}}}}{}
\krule{
\kprefix[green]{k}{\constant[KLabel]{'\_\`{}(\_\`{})}(\reduce{\terminal{lookup}({\variable[Int]{L}})}{\variable[Val]{V}}\kcomma\AnyVar[List\{K\}])}
\mathrel{}\kmiddle[white]{store}{\variable[Int]{L}\mapsto\variable[Val]{V}}
}{}{}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{({{\nonTerminal{\sort{Map}}}},{{\nonTerminal{\sort{K}}}},{{\nonTerminal{\sort{Bag}}}})}{}
\end{syntaxBlock}
\krule{
\kall[green]{k}{\reduce{\constant[KLabel]{'\_\`{}(\_\`{})}(\terminal{methodClosure}({\variable[Id]{Class}},{\variable[Int]{OL}},{\variable[Exps]{XTs}},{\variable[Stmt]{S}},{({\AnyVar[K]}\ \texttt{->}\ {\variable[Type]{T}})})\kcomma\variable[Vals]{Vs})\kra\variable[K]{K}}{\terminal{bindto}({\variable[Exps]{XTs}},{\variable[Vals]{Vs}})\kra\variable[Stmt]{S}\kra\terminal{return}\terminal{;}}}
\mathrel{}\kall[cyan]{control}{\variable[Bag]{C}\mathrel{}\kprefix[blue]{fstack}{\reduce{\dotCt{List}}{({\variable[Map]{Env}},{\variable[K]{K}},{\variable[Bag]{C}\mathrel{}\kall{crntObj}{\variable[Bag]{Obj'}}
\mathrel{}\kall{return}{\variable[Type]{T'}}
})}}
\mathrel{}\kall[Fuchsia]{crntObj}{\reduce{\variable[Bag]{Obj'}}{\kall{crntClass}{\variable[Id]{Class}}
\mathrel{}\variable[Bag]{Obj}}}
\mathrel{}\kall[LimeGreen]{return}{\reduce{\variable[Type]{T'}}{\variable[Type]{T}}}
}
\mathrel{}\kall[violet]{env}{\reduce{\variable[Map]{Env}}{\dotCt{Map}}}
\mathrel{}\kmiddle[white]{store}{\variable[Int]{OL}\mapsto\terminal{objectClosure}({\kall{crntClass}{\AnyVar[Id]}
\mathrel{}\variable[Bag]{Obj}})}
}{}{}
\krule{
\kall[green]{k}{\reduce{\terminal{return}{\variable[Val]{V}}\terminal{;}\kra\AnyVar[K]}{\terminal{subtype}({{\terminal{typeOf}({\variable[Val]{V}})}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}},{{\variable[Type]{T}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}})\kra\terminal{true?}\kra\terminal{unsafeCast}({\variable[Val]{V}},{\variable[Type]{T}})\kra\variable[K]{K}}}
\mathrel{}\kall[cyan]{control}{\kprefix[blue]{fstack}{\reduce{({\variable[Map]{Env}},{\variable[K]{K}},{\variable[Bag]{C}})}{\dotCt{List}}}
\mathrel{}\reduce{\kall[LimeGreen]{return}{\variable[Type]{T}}
\mathrel{}\AnyVar[Bag]}{\variable[Bag]{C}}}
\mathrel{}\kall[violet]{env}{\reduce{\AnyVar[Map]}{\variable[Map]{Env}}}
}{}{}
\krule{
\reduce{{\terminal{objectClosure}({\AnyVar[Bag]\mathrel{}\kprefix{envStack}{{\variable[Id]{Class}}\terminal{::}{\AnyVar[Bag]}}
})}\terminal{instanceOf}{\variable[Id]{Class}}}{\constant[\#Bool]{true}}}{}{}
\krule{
{\terminal{objectClosure}({\AnyVar[Bag]\mathrel{}\kprefix{envStack}{\reduce{{\variable[Id]{Class1}}\terminal{::}{\AnyVar[Bag]}}{\dotCt{List}}}
})}\terminal{instanceOf}{\variable[Id]{Class2}}}{{\variable[Id]{Class1}}\terminal{=/=K}{\variable[Id]{Class2}}}{structural}
\krule{
\reduce{{\terminal{objectClosure}({\AnyVar[Bag]\mathrel{}\kall{envStack}{\dotCt{List}}
})}\terminal{instanceOf}{\variable[K]{Class}}}{\constant[\#Bool]{false}}}{}{}
\krule{
\kprefix[green]{k}{\reduce{\terminal{cast}{\terminal{objectClosure}({\kall{crntClass}{\AnyVar[K]}
\mathrel{}\variable[Bag]{Obj}})}\terminal{to}{\variable[Id]{Class}}}{{\terminal{objectClosure}({\variable[Bag]{Obj}})}\terminal{instanceOf}{\variable[Id]{Class}}\kra\terminal{true?}\kra\terminal{objectClosure}({\kall{crntClass}{\variable[Id]{Class}}
\mathrel{}\variable[Bag]{Obj}})}}
}{}{structural}
\krule{
\kprefix[green]{k}{\terminal{lvalue}({\reduce{\variable[Id]{X}}{\constant[KLabel]{'\_.\_}(\terminal{this}\kcomma\variable[Id]{X})}})}
\mathrel{}\kall[violet]{env}{\variable[Map]{Env}}
}{\neg_{\scriptstyle\it Bool}{{\variable[Id]{X}}\terminal{in}{\terminal{keys}{\variable[Map]{Env}}}}}{structural}
\kcontext{
\terminal{lvalue}({\constant[KLabel]{'\_.\_}(\khole{}\kcomma\AnyVar[Id])})}{}{}
\krule{
\kprefix[green]{k}{\terminal{lvalue}({\reduce{\constant[KLabel]{'\_.\_}(\terminal{objectClosure}({\kall{crntClass}{\variable[Id]{Class}}
\mathrel{}\ksuffix{envStack}{{\variable[Id]{Class}}\terminal{::}{\variable[BagItem]{EnvC}}\mathrel{}\variable[List]{EStack}}
})\kcomma\variable[Id]{X})}{\terminal{lookupMember}({\kall{envStack}{{\variable[Id]{Class}}\terminal{::}{\variable[BagItem]{EnvC}}\mathrel{}\variable[List]{EStack}}
},{\variable[Id]{X}})}})}
}{}{structural}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{{{\nonTerminal{\sort{Id}}}}\terminal{::}{{\nonTerminal{\sort{Bag}}}}}{}
\end{syntaxBlock}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\terminal{lookupMember}({{\nonTerminal{\sort{BagItem}}}},{{\nonTerminal{\sort{Id}}}})}{function, klabel(lookupMember)}
\end{syntaxBlock}
\krule{
\reduce{\terminal{lookupMember}({\kprefix{envStack}{{\AnyVar[Id]}\terminal{::}{\kmiddle{env}{\variable[Id]{X}\mapsto\variable[Int]{L}}
}}
},{\variable[Id]{X}})}{\terminal{lookup}({\variable[Int]{L}})}}{}{anywhere}
\krule{
\terminal{lookupMember}({\kprefix{envStack}{\reduce{{\AnyVar[Id]}\terminal{::}{\kall{env}{\variable[Map]{Env}}
}}{\dotCt{List}}}
},{\variable[Id]{X}})}{\neg_{\scriptstyle\it Bool}{{\variable[Id]{X}}\terminal{in}{\terminal{keys}{\variable[Map]{Env}}}}}{anywhere}
\krule{
\reduce{\terminal{typeOf}({\terminal{objectClosure}({\AnyVar[Bag]\mathrel{}\kprefix{envStack}{{\variable[Id]{Class}}\terminal{::}{\AnyVar[Bag]}}
})})}{\terminal{class}{\variable[Id]{Class}}}}{}{anywhere}
\krule{
\reduce{\terminal{typeOf}({\terminal{methodClosure}({\AnyVar[Id]},{\AnyVar[Nat]},{\AnyVar[K]},{\AnyVar[K]},{\variable[Type]{T}})})}{\variable[Type]{T}}}{}{anywhere}

\begin{syntaxBlock}{\nonTerminal{\sort{Exp}}}\syntax{\terminal{subtype}({{\nonTerminal{\sort{Types}}}},{{\nonTerminal{\sort{Types}}}})}{}
\end{syntaxBlock}
\krule{
\reduce{\terminal{subtype}({{\variable[Type]{T}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}},{{\variable[Type]{T}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}})}{\constant[\#Bool]{true}}}{}{structural}
\krule{
\kprefix[green]{k}{\reduce{\terminal{subtype}({{\terminal{class}{\variable[Id]{Class1}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}},{{\terminal{class}{\variable[Id]{Class}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}})}{\terminal{subtype}({{\terminal{class}{\variable[K]{Class2}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}},{{\terminal{class}{\variable[Id]{Class}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}})}}
\mathrel{}\kall[Fuchsia]{className}{\variable[Id]{Class1}}
\mathrel{}\kall[Fuchsia]{extends}{\variable[K]{Class2}}
}{{\variable[Id]{Class1}}\terminal{=/=K}{\variable[Id]{Class}}}{structural}
\krule{
\reduce{\terminal{subtype}({{\variable[Type]{T1}}\mathpunct{\terminalNoSpace{,}}{{\variable[Type]{T2}}\mathpunct{\terminalNoSpace{,}}{\variable[Types]{Ts}}}},{{\variable[Type]{T1'}}\mathpunct{\terminalNoSpace{,}}{{\variable[Type]{T2'}}\mathpunct{\terminalNoSpace{,}}{\variable[Types]{Ts'}}}})}{\terminal{subtype}({{\variable[Type]{T1}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}},{{\variable[Type]{T1'}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}})\kra\terminal{true?}\kra\terminal{subtype}({{\variable[Type]{T2}}\mathpunct{\terminalNoSpace{,}}{\variable[Types]{Ts}}},{{\variable[Type]{T2'}}\mathpunct{\terminalNoSpace{,}}{\variable[Types]{Ts'}}})}}{}{structural}
\krule{
\reduce{\terminal{subtype}({\dotCt{Types}},{\dotCt{Types}})}{\constant[\#Bool]{true}}}{}{structural}
\krule{
\reduce{\terminal{subtype}({{\terminal{class}{\terminal{object}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}},{{\terminal{class}{\variable[K]{Class}}}\mathpunct{\terminalNoSpace{,}}{\dotCt{Types}}})}{\constant[\#Bool]{false}}}{{\variable[K]{Class}}\terminal{=/=K}{\terminal{object}}}{structural}

\begin{syntaxBlock}{\nonTerminal{\sort{Val}}}\syntax{\terminal{unsafeCast}({{\nonTerminal{\sort{Val}}}},{{\nonTerminal{\sort{Type}}}})}{function, klabel(unsafeCast)}
\end{syntaxBlock}
\krule{
\reduce{\terminal{unsafeCast}({\terminal{objectClosure}({\kall{crntClass}{\AnyVar[K]}
\mathrel{}\variable[Bag]{Obj}})},{\terminal{class}{\variable[Id]{Class}}})}{\terminal{objectClosure}({\kall{crntClass}{\variable[Id]{Class}}
\mathrel{}\variable[Bag]{Obj}})}}{}{anywhere}
\krule{
\reduce{\terminal{unsafeCast}({\variable[Val]{V}},{\variable[Type]{T}})}{\variable[Val]{V}}}{{\terminal{typeOf}({\variable[Val]{V}})}\terminal{==K}{\variable[Type]{T}}}{anywhere}

\begin{syntaxBlock}{\nonTerminal{\sort{K}}}\syntax{\terminal{true?}}{}
\end{syntaxBlock}
\krule{
\reduce{\constant[\#Bool]{true}\kra\terminal{true?}}{\dotCt{K}}}{}{structural}
\end{module}
\end{kdefinition}
\end{document}
